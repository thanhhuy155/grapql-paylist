pipeline{
	agent any
	tools {
        maven 'Maven3'
        jdk 'JDK8'
    }
	stages{
		stage ('Test'){
			steps{
				node ('android'){
					git branch: 'master',
						credentialsId: 'b4006acc-b754-4381-9c27-c1c5d9c1629b',
						url: 'https://HeraNguyen@bitbucket.org/HeraNguyen/mobile-test-pcom.git'
                    bat 'mvn clean test -DsuiteXmlFile=MasterSuite_AndroidFailedTests.xml'
                }
			}
		}
	}
	post{
		always{
            node('android')
            {
                bat 'C:\\Users\\ENCLAVEIT\\.jenkins\\tools\\allure2.6.0\\allure-2.6.0\\bin\\allure.bat generate C:\\agents\\android\\workspace\\AndroidAllTestSuites\\allure-results -c -o C:\\agents\\android\\workspace\\AndroidAllTestSuites\\allure-report'
                allure([
        			includeProperties: false,
        			jdk: '',
        			properties: [],
        			reportBuildPolicy: 'ALWAYS',
        			results: [[path: '**/allure-results']],
      			])

            }
				emailext attachLog: true,
          			body: '''${SCRIPT, template="/groovy-html-test.template"}
						<br/>
						<b/>
						<p><font font="Verdana" size="2" color="navy">Please click the link to see the detail report: </font>
						&QUOT;<a href='http://117.3.65.55:9500/view/PhillyDotComNativeAppProjects/job/AndroidAllTestSuites/$BUILD_NUMBER/allure/'>Allure Report link</a>&QUOT;</p>
                        <b/>
						<p><font font="Verdana" size="2" color="navy">BrowserStack Android_SprintC_RerunFailedTests build: </font>
                        &QUOT;<a href='https://app-automate.browserstack.com/'>BrowserStack link</a>&QUOT;</p>

						<br/>''',
					postsendScript: '$DEFAULT_POSTSEND_SCRIPT',
					presendScript: '$DEFAULT_PRESEND_SCRIPT',
					subject: '$DEFAULT_SUBJECT_Android_Rerun_Failed_Tests',
          			to: 'hera@enclave.vn, donna@enclave.vn, pduncan@phillynews.com, tdang@philly.com, hanie@enclave.vn, missy@enclave.vn'
		}
	}

}